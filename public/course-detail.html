<!DOCTYPE html>
<html>

<head>
    <title>Course Details</title>
    <style>
        /* Basic styling for the course details */
        .detail-label {
            font-weight: bold;
        }

        .detail-value {
            margin-bottom: 10px;
        }

        /* Style for the review bars */
        .review-category {
            margin-top: 10px;
        }

        .review-bar-container {
            width: 100%;
            background-color: #f0f0f0;
            margin-top: 5px;
        }

        .review-bar {
            width: 0%;
            height: 20px;
        }

        #rigor-bar {
            background-color: #2196f3;
            /* Blue */
        }

        #workload-bar {
            background-color: #4caf50;
            /* Green */
        }

        #involvement-bar {
            background-color: #ff9800;
            /* Orange */
        }

        #homework-bar {
            background-color: #9c27b0;
            /* Purple */
        }

        .teacher-review-section { /* Style for each teacher's review section */
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <h1>Course Details</h1>
    <div id="course-details">
    </div>
    <div id="teacher-reviews">
        </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const courseDetailsDiv = document.getElementById('course-details');
            const teacherReviewsDiv = document.getElementById('teacher-reviews'); // Get the new div

            // Function to get the course ID from the query parameter
            const getCourseId = () => {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get('courseId');
            };

            // Function to fetch and display course details from Firestore
            const fetchCourseDetails = async (courseId) => {
                // Replace with your Firebase initialization and firestore reference
                const db = firebase.firestore();

                try {
                    const courseDoc = await db.collection('courses').doc(courseId).get();
                    if (courseDoc.exists) {
                        const courseData = courseDoc.data();

                        // Create and append elements to display course details
                        const courseCodeDiv = document.createElement('div');
                        courseCodeDiv.classList.add('detail-item');
                        courseCodeDiv.innerHTML = `<span class="detail-label">Course Code:</span> <span class="detail-value">${courseData.courseCode}</span>`;
                        courseDetailsDiv.appendChild(courseCodeDiv);

                        const courseNameDiv = document.createElement('div');
                        courseNameDiv.classList.add('detail-item');
                        courseNameDiv.innerHTML = `<span class="detail-label">Course Name:</span> <span class="detail-value">${courseData.courseName}</span>`;
                        courseDetailsDiv.appendChild(courseNameDiv);

                        const creditsDiv = document.createElement('div');
                        creditsDiv.classList.add('detail-item');
                        creditsDiv.innerHTML = `<span class="detail-label">Credits:</span> <span class="detail-value">${courseData.credits}</span>`;
                        courseDetailsDiv.appendChild(creditsDiv);

                        // Fetch and display teacher reviews
                        await fetchAndDisplayTeacherReviews(db, courseId);

                    } else {
                        courseDetailsDiv.innerHTML = '<p>Course not found</p>';
                    }
                } catch (error) {
                    console.error("Error fetching course details:", error);
                    courseDetailsDiv.innerHTML = '<p>Error fetching course details</p>';
                }
            };

            // Function to fetch and display reviews for all teachers
            const fetchAndDisplayTeacherReviews = async (db, courseId) => {
                try {
                    const teachersSnapshot = await db.collection('courses').doc(courseId).collection('Teachers').get();

                    if (!teachersSnapshot.empty) {
                        teachersSnapshot.forEach(async (teacherDoc) => {
                            const teacherName = teacherDoc.id;
                            const reviewsSnapshot = await teacherDoc.ref.collection('reviews').get();
                            const reviews =;

                            if (!reviewsSnapshot.empty) {
                                reviewsSnapshot.forEach(reviewDoc => {
                                    reviews.push(reviewDoc.data());
                                });
                            }

                            displayTeacherReviewAverages(teacherName, reviews);
                        });
                    } else {
                        teacherReviewsDiv.innerHTML = '<p>No teachers found for this course.</p>';
                    }
                } catch (error) {
                    console.error("Error fetching teacher reviews:", error);
                    teacherReviewsDiv.innerHTML = '<p>Error fetching teacher reviews.</p>';
                }
            };

            // Function to calculate and display average review data for a teacher
            const displayTeacherReviewAverages = (teacherName, reviews) => {
                if (reviews.length === 0) {
                    return; // Don't display if no reviews
                }

                let totalHomework = 0;
                let totalSubjectRigor = 0;
                let totalTeacherInvolvement = 0;
                let totalWorkload = 0;

                reviews.forEach(review => {
                    totalHomework += review.homework;
                    totalSubjectRigor += review.subjectRigor;
                    totalTeacherInvolvement += review.teacherInvolvement;
                    totalWorkload += review.workload;
                });

                const avgHomework = totalHomework / reviews.length;
                const avgSubjectRigor = totalSubjectRigor / reviews.length;
                const avgTeacherInvolvement = totalTeacherInvolvement / reviews.length;
                const avgWorkload = totalWorkload / reviews.length;

                // Create a section for the teacher's reviews
                const teacherSection = document.createElement('div');
                teacherSection.classList.add('teacher-review-section');

                // Add teacher name
                const teacherNameHeader = document.createElement('h2');
                teacherNameHeader.textContent = `Teacher: ${teacherName}`;
                teacherSection.appendChild(teacherNameHeader);

                // Add review bars
                teacherSection.innerHTML += `
                    <div class="review-category">
                        <span class="detail-label">Subject Rigor:</span>
                        <span id="rigor-score-${teacherName}">${avgSubjectRigor.toFixed(1)}</span>
                        <div class="review-bar-container">
                            <div id="rigor-bar-${teacherName}" class="review-bar" style="width: ${avgSubjectRigor * 20}%;"></div>
                        </div>
                    </div>
                    <div class="review-category">
                        <span class="detail-label">Workload:</span>
                        <span id="workload-score-${teacherName}">${avgWorkload.toFixed(1)}</span>
                        <div class="review-bar-container">
                            <div id="workload-bar-${teacherName}" class="review-bar" style="width: ${avgWorkload * 20}%;"></div>
                        </div>
                    </div>
                    <div class="review-category">
                        <span class="detail-label">Teacher Involvement:</span>
                        <span id="involvement-score-${teacherName}">${avgTeacherInvolvement.toFixed(1)}</span>
                        <div class="review-bar-container">
                            <div id="involvement-bar-${teacherName}" class="review-bar" style="width: ${avgTeacherInvolvement * 20}%;"></div>
                        </div>
                    </div>
                    <div class="review-category">
                        <span class="detail-label">Homework:</span>
                        <span id="homework-score-${teacherName}">${avgHomework.toFixed(1)}</span>
                        <div class="review-bar-container">
                            <div id="homework-bar-${teacherName}" class="review-bar" style="width: ${avgHomework * 20}%;"></div>
                        </div>
                    </div>
                `;

                teacherReviewsDiv.appendChild(teacherSection);
            };

            // Load course details and teacher reviews on page load
            const courseId = getCourseId();
            if (courseId) {
                fetchCourseDetails(courseId);
            } else {
                courseDetailsDiv.innerHTML = '<p>No course ID provided.</p>';
            }
        });
    </script>
</body>

</html>
